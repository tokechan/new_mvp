# オンボーディング 実機テストガイド

## 問題
既存ユーザーのアカウントではオンボーディングが表示されないため、実機で検証できない

## 解決方法

### ✅ DevTools ページを作成（推奨）

実機テスト専用の開発ツールページを作成しました。

---

## 実機テストの手順

### 1. DevTools ページにアクセス

既存ユーザーでログインした状態で以下にアクセス：

```
http://localhost:3000/dev-tools/onboarding
```

### 2. 現在の状態を確認

- ✅ オンボーディング完了済み: 緑色のチェックマーク
- ❌ オンボーディング未完了: 灰色の×マーク

### 3. オンボーディングをリセット

「**オンボーディングをリセット**」ボタンをクリック

→ localStorage から完了状態が削除される  
→ 自動的に `/onboarding` にリダイレクト  
→ 全3ステップを確認可能

### 4. テスト完了後

オンボーディング完了後、再度 `/dev-tools/onboarding` にアクセスすると
「オンボーディング完了済み」になっていることを確認

---

## DevTools の機能

### 現在の状態を確認
- localStorage の `youdo_onboarding_complete` の値を表示
- 完了済み / 未完了の状態を視覚的に表示

### オンボーディングをリセット
- localStorage から完了状態を削除
- 自動的にオンボーディングページへリダイレクト
- 実機テストに最適

### オンボーディングを完了にする
- 手動で完了状態を設定
- デバッグ時に便利

### 直接アクセス
- オンボーディングページへの直接リンク
- 完了済みの場合は自動的に `/app` にリダイレクト

---

## 実機テストのチェックリスト

### ✅ Step 1: 機能紹介
- [ ] 3つの機能カードが表示される
- [ ] アイコンが正しく表示される
- [ ] 「次へ」ボタンで Step 2 に進める
- [ ] 「スキップ」ボタンで /app にリダイレクトされる

### ✅ Step 2: PWA インストール案内
- [ ] プラットフォーム別の案内が正しく表示される
  - [ ] iOS: 共有ボタンの手順
  - [ ] Android: メニューの手順
  - [ ] Desktop: アドレスバーの手順
- [ ] 「今すぐインストール」ボタンが機能する（Android/Desktop）
- [ ] インストール済みの場合、完了画面が表示される

### ✅ Step 3: プッシュ通知設定
- [ ] 通知のメリットが3つ表示される
- [ ] 「通知を有効にする」ボタンが動作する
- [ ] 有効化後、成功画面が表示される
- [ ] 「後で設定する」でも進行できる

### ✅ フロー全体
- [ ] 完了時に /app にリダイレクトされる
- [ ] 2回目のアクセス時に /app にリダイレクトされる
- [ ] DevTools で再度リセットできる

---

## 従来の方法（DevTools がない場合）

### localStorage をクリア

ブラウザの DevTools Console で：

```javascript
localStorage.removeItem('youdo_onboarding_complete')
location.reload()
```

→ `/app` にアクセスすると `/onboarding` にリダイレクト

### シークレットウィンドウ

新しいシークレットウィンドウでアプリにアクセス

### 新しいテストアカウント

新規ユーザーでサインアップ

---

## 実機テストの注意点

### iOS でのテスト
- Safari でホーム画面に追加（A2HS）するとプッシュ通知が有効になる
- ブラウザで開いているだけではプッシュ通知は使用不可
- PWA として起動後、Step 3 のテストを実施

### Android でのテスト
- Chrome で `beforeinstallprompt` イベントが正常に動作する
- 「今すぐインストール」ボタンが表示される
- PWA インストール後、プッシュ通知をテスト

### Desktop でのテスト
- Chrome / Edge で `beforeinstallprompt` が動作する
- PWA インストール後、スタンドアロンモードで動作確認

---

## トラブルシューティング

### DevTools ページが見つからない
- ビルドが失敗している可能性があります
- `npm run build` でエラーを確認

### リセット後もオンボーディングが表示されない
- ブラウザのキャッシュをクリア
- ハードリロード（Cmd+Shift+R / Ctrl+Shift+R）

### オンボーディングが止まる
- ブラウザのコンソールでエラーを確認
- ネットワークタブで API エラーがないか確認

---

## 本番環境での注意

⚠️ DevTools ページは本番環境では非表示にすることを推奨

### 非表示にする方法

#### 方法1: 環境変数で制御
`.env.local` に追加：

```bash
NEXT_PUBLIC_ENABLE_DEVTOOLS=false
```

`src/app/dev-tools/layout.tsx` で判定：

```typescript
const isDevToolsEnabled = process.env.NEXT_PUBLIC_ENABLE_DEVTOOLS === 'true'

if (!isDevToolsEnabled) {
  return <NotFound />
}
```

#### 方法2: ビルド時に除外

`.gitignore` に `src/app/dev-tools` を追加し、
本番ビルド時にビルドしない

#### 方法3: 認証で保護

DevTools ページに管理者認証を追加

---

## まとめ

### DevTools のメリット
✅ 既存ユーザーでも簡単にテストできる  
✅ UI で直感的に操作できる  
✅ 状態の確認とリセットが簡単  
✅ 本番環境で非表示にしやすい  

### 推奨フロー
1. 実機テスト開始 → `/dev-tools/onboarding` にアクセス
2. リセット → オンボーディングページを表示
3. 各ステップを確認
4. 完了後、DevTools で状態を確認
5. 必要に応じて再度リセットしてテスト

---

**作成日**: 2025-11-01  
**用途**: 実機テスト・デバッグ  
**アクセス**: `/dev-tools/onboarding`

