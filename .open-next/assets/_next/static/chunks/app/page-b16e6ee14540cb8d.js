(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2764:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var a=r(5155),s=r(2115),n=r(3084),l=r(4153),o=r(2890),i=r(598);let c=i.Ikc({toUserId:i.YjP().uuid("有効なユーザーIDを指定してください"),choreId:i.aig().int().positive("有効な家事IDを指定してください").optional(),message:i.YjP().min(1,"メッセージを入力してください").max(500,"メッセージは500文字以内で入力してください").trim()});async function d(e,t){let r=c.parse(t),{data:a,error:s}=await o.supabase.from("thanks").insert({from_id:e,to_id:r.toUserId,message:r.message,created_at:new Date().toISOString()}).select("\n      *,\n      from_user:profiles!from_id(display_name),\n      to_user:profiles!to_id(display_name)\n    ").single();if(s)throw console.error("感謝メッセージの送信に失敗しました:",s),Error("感謝メッセージの送信に失敗しました: ".concat(s.message));return a}let u=["ありがとう！助かりました \uD83D\uDE0A","お疲れさまでした！","いつもありがとう ❤️","とても助かります！","ありがとう！愛してる \uD83D\uDC95","お疲れさま！感謝してます","ありがとう！嬉しいです","いつも本当にありがとう","お疲れさま！大好き","ありがとう！頼りになります"];function m(e){let{choreId:t,toUserId:r,toUserName:o,onSuccess:i,onCancel:c}=e,[m,x]=(0,s.useState)(""),[h,g]=(0,s.useState)(!1),[f,p]=(0,s.useState)(null),{user:b}=(0,n.A)(),{addNotification:v}=(0,l.E)(),y=async e=>{if(e.preventDefault(),!b)return void p("ログインが必要です");if(!m.trim())return void p("メッセージを入力してください");g(!0),p(null);try{let e=await d(b.id,{choreId:parseInt(t),toUserId:r,message:m.trim()});v({title:"ありがとうメッセージを送信しました",message:"".concat(o||"相手","にありがとうメッセージを送信しました"),type:"success"}),null==i||i(e),x("")}catch(e){console.error("ありがとうメッセージの送信に失敗しました:",e),p(e instanceof Error?e.message:"メッセージの送信に失敗しました。もう一度お試しください。")}finally{g(!1)}};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-md mx-auto",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:[o?"".concat(o,"さんに"):"","ありがとうメッセージを送る"]}),f&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:f}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,a.jsxs)("fieldset",{children:[(0,a.jsx)("legend",{className:"block text-sm font-medium text-gray-700 mb-2",children:"定型メッセージから選択"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-2",children:u.map((e,t)=>(0,a.jsx)("button",{type:"button",onClick:()=>{x(e)},className:"text-left p-2 text-sm bg-gray-50 hover:bg-gray-100 rounded border transition-colors","aria-label":"定型メッセージを選択: ".concat(e),children:e},t))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"メッセージ"}),(0,a.jsx)("textarea",{id:"message",value:m,onChange:e=>x(e.target.value),placeholder:"ありがとうメッセージを入力してください...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:h})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:h||!m.trim(),className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:h?"送信中...":"送信する"}),c&&(0,a.jsx)("button",{type:"button",onClick:c,disabled:h,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"キャンセル"})]})]})]})}},2946:(e,t,r)=>{"use strict";r.d(t,{QA:()=>f,Op:()=>x,X$:()=>o,u1:()=>d,wl:()=>g,rP:()=>m,JG:()=>u,NQ:()=>h,L4:()=>c,Pu:()=>i});class a{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(this.baseUrl).concat(e),a={"Content-Type":"application/json"};{let e=localStorage.getItem("supabase.auth.token");e&&(a.Authorization="Bearer ".concat(e))}let s={...t,headers:{...a,...t.headers}};try{let e=await fetch(r,s);if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||t.error||"HTTP ".concat(e.status,": ").concat(e.statusText))}return await e.json()}catch(e){throw console.error("API Request failed:",{url:r,error:e}),e}}async get(e){return this.request(e,{method:"GET"})}async post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e){return this.request(e,{method:"DELETE"})}constructor(e=""){this.baseUrl=e}}let s=new a;class n{async createInvitation(e){return s.post("/api/invitations",e)}async getInvitations(){return(await s.get("/api/invitations")).invitations}async getInvitation(e){return s.get("/api/invitations/".concat(e))}async acceptInvitation(e){return s.post("/api/invitations/".concat(e))}async cancelInvitation(e){await s.delete("/api/invitations/".concat(e))}async cleanupExpiredInvitations(){await s.post("/api/invitations/cleanup")}}let l=new n;function o(e){let t=encodeURIComponent(e);return"https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=".concat(t)}function i(e){return/^[a-f0-9]{32}$/i.test(e)}function c(e){let t=new Date,r=new Date(e).getTime()-t.getTime();if(r<=0)return{days:0,hours:0,minutes:0,expired:!0};let a=Math.floor(r/864e5);return{days:a,hours:Math.floor(r%864e5/36e5),minutes:Math.floor(r%36e5/6e4),expired:!1}}function d(e){return e instanceof Error?e.message:"string"==typeof e?e:"予期しないエラーが発生しました"}function u(e){switch(e){case"pending":return"招待中";case"accepted":return"受諾済み";case"expired":return"期限切れ";case"cancelled":return"キャンセル済み";default:return"不明"}}function m(e){switch(e){case"pending":return"text-yellow-600 bg-yellow-100";case"accepted":return"text-green-600 bg-green-100";case"expired":default:return"text-gray-600 bg-gray-100";case"cancelled":return"text-red-600 bg-red-100"}}async function x(e){return l.createInvitation(e)}async function h(){return l.getInvitations()}async function g(e){return l.getInvitation(e)}async function f(e){return l.acceptInvitation(e)}},3807:(e,t,r)=>{Promise.resolve().then(r.bind(r,5132))},3998:(e,t,r)=>{"use strict";r.d(t,{$:()=>c});var a=r(5155),s=r(2115),n=r(2467),l=r(3101),o=r(4269);let i=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:l,asChild:c=!1,...d}=e,u=c?n.DX:"button";return(0,a.jsx)(u,{className:(0,o.cn)(i({variant:s,size:l,className:r})),ref:t,...d})});c.displayName="Button"},4269:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n,i:()=>l});var a=r(2821),s=r(5889);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}function l(e){return Array.from(e.querySelectorAll('button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href], [tabindex]:not([tabindex="-1"])'))}},5132:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>N});var a=r(5155),s=r(3084),n=r(4153),l=r(63),o=r(2115),i=r(2890);let c=async()=>{{let t={user:{id:"550e8400-e29b-41d4-a716-446655440000",email:"test@example.com",user_metadata:{name:"テストユーザー"},app_metadata:{},aud:"authenticated",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},access_token:"mock-token",refresh_token:"mock-refresh-token",expires_in:3600,expires_at:Date.now()/1e3+3600,token_type:"bearer"};try{var e;await i.supabase.auth.setSession({access_token:t.access_token,refresh_token:t.refresh_token}),await new Promise(e=>setTimeout(e,200));let{data:{session:r}}=await i.supabase.auth.getSession();return console.log("テスト用セッション設定完了:",null==r||null==(e=r.user)?void 0:e.id),!0}catch(e){return console.warn("テスト用セッション設定に失敗:",e),!1}}};var d=r(2764),u=r(5239),m=r(2946);function x(e){let{onPartnerLinked:t}=e,{user:r}=(0,s.A)(),[n,l]=(0,o.useState)(!1),[i,c]=(0,o.useState)(null),[d,x]=(0,o.useState)([]),[h,g]=(0,o.useState)(null),[f,p]=(0,o.useState)(!1),[b,v]=(0,o.useState)(""),y=(0,o.useCallback)(async()=>{if(r)try{l(!0);let e=await (0,m.NQ)();x(e||[]);let t=null==e?void 0:e.find(e=>"pending"===e.status&&new Date(e.expires_at)>new Date);g(t||null),c(null)}catch(e){c((0,m.u1)(e))}finally{l(!1)}},[r]),w=async()=>{if(r)try{l(!0),c(null);let e=await (0,m.Op)({invitee_email:b||void 0});e.success&&e.data?(await y(),v("")):c(e.error||"招待の作成に失敗しました")}catch(e){c((0,m.u1)(e))}finally{l(!1)}},j=async e=>{try{await navigator.clipboard.writeText(e);let t=document.activeElement;if(t){let e=t.textContent;t.textContent="コピー済み！",setTimeout(()=>{t.textContent=e},2e3)}}catch(e){console.error("クリップボードへのコピーに失敗:",e),c("クリップボードへのコピーに失敗しました")}};return((0,o.useEffect)(()=>{y()},[r,y]),r)?(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 dark:bg-zinc-900 dark:border-zinc-700",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-zinc-100",children:"\uD83E\uDD1D パートナーを招待"}),i&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm dark:bg-red-950/30 dark:border-red-800 dark:text-red-400",children:i}),h?(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg dark:bg-blue-950/30 dark:border-blue-800",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-400",children:"招待中"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((0,m.rP)(h.status)),children:(0,m.JG)(h.status)})]}),(0,a.jsxs)("div",{className:"text-sm text-blue-700 dark:text-blue-300 mb-3",children:[h.invitee_email&&(0,a.jsxs)("div",{children:["招待先: ",h.invitee_email]}),(0,a.jsxs)("div",{children:["有効期限: ",(()=>{let e=(0,m.L4)(h.expires_at);return e.expired?"期限切れ":e.days>0?"".concat(e.days,"日後"):e.hours>0?"".concat(e.hours,"時間後"):"".concat(e.minutes,"分後")})()]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>j("".concat(window.location.origin,"/invite/").concat(h.invite_code)),className:"px-3 py-2 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 transition-colors",children:"招待URLをコピー"}),(0,a.jsx)("button",{onClick:()=>p(!f),className:"px-3 py-2 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 transition-colors",children:f?"QRコードを隠す":"QRコードを表示"})]}),f&&(0,a.jsxs)("div",{className:"mt-3 text-center",children:[(0,a.jsx)(u.default,{src:(0,m.X$)("".concat(window.location.origin,"/invite/").concat(h.invite_code)),alt:"招待QRコード",className:"mx-auto border border-gray-200 rounded",width:200,height:200}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-2 dark:text-zinc-400",children:"QRコードをスキャンして招待を受け取れます"})]})]})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"invitee-email",className:"block text-sm font-medium text-gray-700 mb-2 dark:text-zinc-300",children:"パートナーのメールアドレス（任意）"}),(0,a.jsx)("input",{id:"invitee-email",type:"email",value:b,onChange:e=>v(e.target.value),placeholder:"partner@example.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:border-zinc-600 dark:bg-zinc-800 dark:text-zinc-100",disabled:n}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-zinc-400",children:"メールアドレスは記録用です。招待リンクは誰でも使用できます。"})]}),(0,a.jsx)("button",{onClick:w,disabled:n,className:"w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:n?"招待リンクを生成中...":"招待リンクを生成"})]}),d.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3 dark:text-zinc-300",children:"招待履歴"}),(0,a.jsx)("div",{className:"space-y-2",children:d.slice(0,3).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg dark:bg-zinc-800",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900 dark:text-zinc-100",children:e.invitee_email||"招待コード: "+e.invite_code.slice(0,8)+"..."}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-zinc-400",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((0,m.rP)(e.status)),children:(0,m.JG)(e.status)})]},e.id))})]})]}):null}var h=r(3998),g=r(5590),f=r(4269);function p(e){let{className:t,...r}=e;return(0,a.jsx)("div",{className:(0,f.cn)("animate-pulse rounded-md bg-primary/10",t),...r})}var b=r(9840),v=r(2779);b.bL,o.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(b.q7,{ref:t,className:(0,f.cn)("border-b",r),...s})}).displayName="AccordionItem",o.forwardRef((e,t)=>{let{className:r,children:s,...n}=e;return(0,a.jsx)(b.Y9,{className:"flex",children:(0,a.jsxs)(b.l9,{ref:t,className:(0,f.cn)("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",r),...n,children:[s,(0,a.jsx)(v.A,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})})}).displayName=b.l9.displayName,o.forwardRef((e,t)=>{let{className:r,children:s,...n}=e;return(0,a.jsx)(b.UC,{ref:t,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,a.jsx)("div",{className:(0,f.cn)("pb-4 pt-0",r),children:s})})}).displayName=b.UC.displayName;let y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{politeness:t="polite",autoCreateLiveRegion:r=!0}=e,a=(0,o.useRef)(null),s=(0,o.useRef)(null),n=(0,o.useCallback)(()=>{if(a.current)return a.current;let e=document.querySelector('[aria-live="'.concat(t,'"][data-screen-reader-region]'));if(e)return a.current=e,a.current;if(r){let e=document.createElement("div");return e.setAttribute("aria-live",t),e.setAttribute("aria-atomic","true"),e.setAttribute("data-screen-reader-region","true"),e.style.position="absolute",e.style.left="-10000px",e.style.width="1px",e.style.height="1px",e.style.overflow="hidden",document.body.appendChild(e),a.current=e,e}return null},[t,r]),l=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n();r&&(s.current&&clearTimeout(s.current),t?r.textContent=e:s.current=setTimeout(()=>{r.textContent=e,s.current=setTimeout(()=>{r.textContent=""},1e3)},100))},[n]),i=(0,o.useCallback)((e,t)=>{Object.entries(t).forEach(t=>{let[r,a]=t;(r.startsWith("aria-")||r.startsWith("role"))&&e.setAttribute(r,a)})},[]),c=(0,o.useCallback)((e,t)=>{t.forEach(t=>{(t.startsWith("aria-")||t.startsWith("role"))&&e.removeAttribute(t)})},[]),d=(0,o.useCallback)(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"label";switch(r){case"label":e.setAttribute("aria-label",t);break;case"labelledby":e.setAttribute("aria-labelledby",t);break;case"describedby":e.setAttribute("aria-describedby",t)}},[]),u=(0,o.useCallback)((e,t)=>{let r=e.getAttribute("aria-label")||e.getAttribute("title")||e.textContent||"要素";l("".concat(r,"が").concat(t,"になりました"))},[l]),m=(0,o.useCallback)((e,t)=>{l("".concat(e,"にエラーがあります: ").concat(t),!0)},[l]),x=(0,o.useCallback)(e=>{l("成功: ".concat(e))},[l]),h=(0,o.useCallback)(e=>{l("警告: ".concat(e))},[l]),g=(0,o.useCallback)(e=>{l("エラー: ".concat(e),!0)},[l]);return(0,o.useEffect)(()=>()=>{s.current&&clearTimeout(s.current),r&&a.current&&a.current.parentNode&&a.current.parentNode.removeChild(a.current)},[r]),{announce:l,announceState:u,announceFormError:m,announceSuccess:x,announceWarning:h,announceError:g,setAriaAttributes:i,removeAriaAttributes:c,setAccessibleName:d,liveRegionRef:a}};function w(){let{user:e}=(0,s.A)(),{addNotification:t}=(0,n.E)(),{chores:r,loading:l,isAdding:u,addChore:m,toggleChore:b,deleteChore:v,realtimeEvents:w}=function(){let{user:e}=(0,s.A)(),[t,r]=(0,o.useState)([]),[a,n]=(0,o.useState)(!0),[l,d]=(0,o.useState)(!1),[u,m]=(0,o.useState)({inserts:0,updates:0,deletes:0,lastEvent:null,connectionStatus:"unknown"}),x=(0,o.useCallback)(async()=>{if(e)try{console.log("\uD83D\uDC64 プロフィール確認中:",e.id);let r="550e8400-e29b-41d4-a716-446655440000",{data:a,error:s}=await i.supabase.from("profiles").select("id").eq("id",r).single();if(s&&"PGRST116"!==s.code)throw console.error("プロフィール確認エラー:",s),s;if(a)console.log("✅ プロフィールが存在します");else{var t;console.log("\uD83D\uDCDD プロフィールが存在しないため作成します");let a=(null==(t=e.email)?void 0:t.split("@")[0])||"テストユーザー",{error:s}=await i.supabase.from("profiles").upsert({id:r,display_name:a});if(s)throw console.error("プロフィール作成エラー:",s),s;console.log("✅ プロフィールを作成しました:",a)}}catch(e){throw console.warn("プロフィール確認/作成に失敗しました:",e),e}},[e]),h=(0,o.useCallback)(async()=>{if(e)try{let{data:t,error:a}=await i.supabase.from("chores").select("*").or("owner_id.eq.".concat(e.id,",partner_id.eq.").concat(e.id)).order("created_at",{ascending:!1});if(a)throw a;r(t||[])}catch(e){console.error("家事の取得に失敗しました:",e)}finally{n(!1)}},[e]),g=(0,o.useCallback)(async t=>{if(!e||!t.trim())return!1;console.log("➕ Starting add chore operation:",t.trim()),d(!0);try{if(!await c())throw Error("テスト環境でのセッション設定に失敗しました");await x();let e={title:t.trim(),owner_id:"550e8400-e29b-41d4-a716-446655440000",partner_id:null,done:!1};console.log("\uD83D\uDCDD Inserting chore data:",e);let{data:a,error:s}=await i.supabase.from("chores").insert([e]).select().single();if(s)throw console.error("❌ Add chore operation failed:",s),s;return console.log("✅ Add chore operation successful:",a),a&&r(e=>e.some(e=>e.id===a.id)?e:[a,...e]),console.log("✨ Add chore completed successfully"),!0}catch(e){throw console.error("❌ 家事の追加に失敗しました:",e),e}finally{d(!1)}},[e,x]),f=(0,o.useCallback)(async(t,a)=>{let s=!a;console.log("\uD83D\uDD04 Starting toggle chore operation: ID=".concat(t,", ").concat(a?"completed":"pending"," → ").concat(s?"completed":"pending"));try{console.log("\uD83D\uDCDD Updating chore status in database");let{error:a}=await i.supabase.from("chores").update({done:s}).eq("id",t);if(a)throw console.error("❌ Toggle chore operation failed:",a),a;if(console.log("✅ Chore status updated successfully"),r(e=>e.map(e=>e.id===t?{...e,done:s}:e)),s&&e){console.log("\uD83D\uDCDD Adding completion record");let{error:r}=await i.supabase.from("completions").insert({chore_id:t,user_id:e.id});r?console.error("❌ 完了記録の追加に失敗しました:",r):console.log("✅ Completion record added successfully")}console.log("✨ Toggle chore completed successfully")}catch(e){throw console.error("❌ 家事の更新に失敗しました:",e),e}},[e]),p=(0,o.useCallback)(async e=>{console.log("\uD83D\uDDD1️ Starting delete operation for chore ID:",e);try{let{error:t,data:a}=await i.supabase.from("chores").delete().eq("id",e).select();if(t)throw console.error("❌ Delete operation failed:",t),t;console.log("✅ Delete operation successful:",a),r(t=>t.filter(t=>t.id!==e)),console.log("✨ Delete chore completed successfully"),setTimeout(()=>{console.log("⏰ Post-delete connection check: Realtime should still be active"),console.log("\uD83D\uDCCA Current realtime events count:",u)},1e3)}catch(e){throw console.error("❌ 家事の削除に失敗しました:",e),e}},[u]);return(0,o.useEffect)(()=>{if(!e){console.log("\uD83D\uDC64 No user logged in, skipping Realtime setup"),r([]),n(!1);return}console.log("\uD83D\uDE80 Setting up Realtime for user:",e.id),h(),console.log("\uD83D\uDD04 Setting up Realtime subscription with REPLICA IDENTITY FULL"),console.log("\uD83D\uDD27 User ID for filters:",e.id);let t=i.supabase.channel("chores-realtime-".concat(e.id,"-").concat(Date.now())).on("postgres_changes",{event:"INSERT",schema:"public",table:"chores",filter:"owner_id=eq.".concat(e.id)},t=>{console.log("\uD83D\uDFE2 INSERT EVENT RECEIVED (owner):",t);let a=t.new;a&&(a.owner_id===e.id||a.partner_id===e.id)&&(console.log("\uD83D\uDCDD Adding chore to state:",a.title),r(e=>{if(e.some(e=>String(e.id)===String(a.id)))return console.log("⚠️ INSERT: Chore already exists, skipping:",a.id),e;let t=[a,...e];return console.log("\uD83D\uDCCA Updated chores count:",t.length),t}),m(e=>({...e,inserts:e.inserts+1,lastEvent:"INSERT: ".concat(a.title)})))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"chores",filter:"owner_id=eq.".concat(e.id)},t=>{console.log("\uD83D\uDFE1 UPDATE EVENT RECEIVED (owner):",t);let a=t.new;a&&(a.owner_id===e.id||a.partner_id===e.id)&&(console.log("\uD83D\uDCDD Updating chore in state:",a.title),r(e=>{let t=e.map(e=>String(e.id)===String(a.id)?a:e);return console.log("\uD83D\uDCCA Updated chores after UPDATE:",t.length),t}),m(e=>({...e,updates:e.updates+1,lastEvent:"UPDATE: ".concat(a.title)})))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chores",filter:"owner_id=eq.".concat(e.id)},e=>{console.log("\uD83D\uDD34 DELETE EVENT RECEIVED (owner):",e);let t=e.old.id;t&&(console.log("\uD83D\uDCDD Removing chore from state:",t),r(e=>{let r=e.filter(e=>String(e.id)!==String(t));return console.log("\uD83D\uDCCA Updated chores after DELETE:",r.length),r}),m(e=>({...e,deletes:e.deletes+1,lastEvent:"DELETE: ".concat(t)})))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"chores",filter:"partner_id=eq.".concat(e.id)},e=>{console.log("\uD83D\uDD34 DELETE EVENT RECEIVED (partner):",e);let t=e.old.id;t&&(console.log("\uD83D\uDCDD Removing chore from state (as partner):",t),r(e=>{let r=e.filter(e=>String(e.id)!==String(t));return console.log("\uD83D\uDCCA Updated chores after DELETE:",r.length),r}),m(e=>({...e,deletes:e.deletes+1,lastEvent:"DELETE: ".concat(t)})))}).subscribe((t,r)=>{console.log("\uD83D\uDCE1 Realtime subscription status:",t,"for user:",e.id),m(e=>({...e,connectionStatus:"SUBSCRIBED"===t?"connected":"CHANNEL_ERROR"===t?"error":"TIMED_OUT"===t?"disconnected":"unknown"})),r&&(console.error("❌ Realtime subscription error:",r),m(e=>({...e,connectionStatus:"error"}))),"SUBSCRIBED"===t&&console.log("✅ Successfully subscribed to realtime changes for user:",e.id)});return console.log("\uD83D\uDCE1 Realtime channel created for user:",e.id),()=>{console.log("\uD83E\uDDF9 Cleaning up Realtime subscription for user:",e.id),i.supabase.removeChannel(t)}},[null==e?void 0:e.id,e,h]),{chores:t,loading:a,isAdding:l,realtimeEvents:u,addChore:g,toggleChore:f,deleteChore:p,refetch:h}}(),{announce:j,announceSuccess:N,announceError:k,announceFormError:E}=y(),{saveFocus:C,restoreFocus:_,focusFirstElement:S}=(()=>{let e=(0,o.useRef)(null),t=(0,o.useCallback)(()=>{e.current=document.activeElement},[]),r=(0,o.useCallback)(()=>{e.current&&"function"==typeof e.current.focus&&e.current.focus()},[]),a=(0,o.useCallback)((e,t)=>{e&&"function"==typeof e.focus&&e.focus(t)},[]);return{saveFocus:t,restoreFocus:r,setFocus:a,focusFirstElement:(0,o.useCallback)(e=>{let t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t.length>0&&t[0].focus()},[]),focusLastElement:(0,o.useCallback)(e=>{let t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t.length>0&&t[t.length-1].focus()},[])}})(),D=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{enabled:t=!0,loop:r=!0,escapeToClose:a=!1,onEscape:s,onEnter:n,onFocusChange:l}=e,i=(0,o.useRef)(null),c=(0,o.useRef)(-1),d=(0,o.useCallback)(()=>i.current?(0,f.i)(i.current):[],[]),u=(0,o.useCallback)(e=>{let t=d();if(0===t.length)return;let a=e;r?a<0?a=t.length-1:a>=t.length&&(a=0):a=Math.max(0,Math.min(a,t.length-1));let s=t[a];s&&(s.focus(),c.current=a,null==l||l(s,a))},[d,r,l]),m=(0,o.useCallback)(()=>{u(c.current+1)},[u]),x=(0,o.useCallback)(()=>{u(c.current-1)},[u]),h=(0,o.useCallback)(()=>{u(0)},[u]),g=(0,o.useCallback)(()=>{u(d().length-1)},[u,d]),p=(0,o.useCallback)(()=>{if(!i.current)return;let e=d(),t=document.activeElement;c.current=e.findIndex(e=>e===t)},[d]),b=(0,o.useCallback)(e=>{if(!t||!i.current)return;let r=document.activeElement;if(i.current.contains(r))switch(e.key){case"ArrowDown":case"ArrowRight":e.preventDefault(),p(),m();break;case"ArrowUp":case"ArrowLeft":e.preventDefault(),p(),x();break;case"Home":e.preventDefault(),h();break;case"End":e.preventDefault(),g();break;case"Enter":n&&(e.preventDefault(),n(r));break;case"Escape":a&&s&&(e.preventDefault(),s())}},[t,p,m,x,h,g,n,a,s]),v=(0,o.useCallback)(e=>{if(!t||!i.current)return;let r=e.target;i.current.contains(r)&&p()},[t,p]);return(0,o.useEffect)(()=>{if(t)return document.addEventListener("keydown",b),document.addEventListener("focusin",v),()=>{document.removeEventListener("keydown",b),document.removeEventListener("focusin",v)}},[t,b,v]),{containerRef:i,focusNext:m,focusPrevious:x,focusFirst:h,focusLast:g,focusElementAtIndex:u,getFocusableElements:d,currentFocusIndex:c.current}}({enabled:!0,loop:!0,onFocusChange:(e,t)=>{let r=e.getAttribute("data-chore-name");r&&j("".concat(r,"にフォーカスしました"))}}),[R,I]=(0,o.useState)(""),[T,A]=(0,o.useState)(null),[L,z]=(0,o.useState)(null),[U,q]=(0,o.useState)(null),[P,M]=(0,o.useState)(!1),B=(0,o.useCallback)(async()=>{if(!e)return void console.log("\uD83D\uDC64 ユーザーが未ログインのため、パートナー情報取得をスキップ");console.log("\uD83D\uDD0D パートナー情報を取得中...",e.id);try{let{data:t,error:r}=await i.supabase.from("profiles").select("partner_id, display_name").eq("id",e.id).single();if(console.log("\uD83D\uDCCA プロフィール取得結果:",{profile:t,error:r}),r){console.error("❌ パートナー情報取得エラー:",r),z(!1),q(null);return}if(null==t?void 0:t.partner_id){console.log("✅ パートナーが存在:",t.partner_id);let{data:e,error:r}=await i.supabase.from("profiles").select("id, display_name").eq("id",t.partner_id).single();r?(console.error("❌ パートナー詳細取得エラー:",r),z(!0),q({id:t.partner_id,name:"パートナー"})):(console.log("✅ パートナー詳細取得成功:",e),z(!0),q({id:e.id,name:e.display_name||"パートナー"}))}else console.log("❌ パートナーが未設定"),z(!1),q(null)}catch(e){console.error("❌ パートナー情報取得で予期しないエラー:",e),z(!1),q(null)}},[e]),O=async()=>{await B()};(0,o.useEffect)(()=>{e&&B()},[e,B]);let V=async e=>{if(e.preventDefault(),!R.trim())return void E("家事名","家事名を入力してください");try{await m(R.trim()),I(""),N("家事「".concat(R.trim(),"」を追加しました")),t({title:"家事を追加しました",type:"success",message:"家事「".concat(R.trim(),"」を追加しました")})}catch(e){console.error("家事追加エラー:",e),k("家事の追加に失敗しました"),t({title:"エラー",type:"error",message:"家事の追加に失敗しました"})}},$=async e=>{let a=r.find(t=>t.id===e);if(a)try{await b(e,a.done);let r=a.title;N("家事「".concat(r,"」の状態を変更しました")),t({title:"家事を更新しました",type:"success",message:"家事「".concat(r,"」の状態を変更しました")})}catch(e){console.error("家事状態変更エラー:",e),k("家事の状態変更に失敗しました"),t({title:"エラー",type:"error",message:"家事の状態変更に失敗しました"})}},F=async e=>{let a=r.find(t=>t.id===e);if(a&&confirm("家事「".concat(a.title,"」を削除しますか？")))try{await v(e),N("家事「".concat(a.title,"」を削除しました")),t({title:"家事を削除しました",type:"success",message:"家事「".concat(a.title,"」を削除しました")})}catch(e){console.error("家事削除エラー:",e),k("家事の削除に失敗しました"),t({title:"エラー",type:"error",message:"家事の削除に失敗しました"})}};return l?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(p,{className:"h-10 flex-1"}),(0,a.jsx)(p,{className:"h-10 w-20"})]}),[void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(p,{className:"h-16 w-full"},t))]}):!1===L?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(x,{onPartnerLinked:O}),(0,a.jsxs)("form",{onSubmit:V,className:"flex gap-2",children:[(0,a.jsx)(g.p,{type:"text",placeholder:"新しい家事を入力",value:R,onChange:e=>I(e.target.value),disabled:u,className:"flex-1","aria-label":"新しい家事名"}),(0,a.jsx)(h.$,{type:"submit",disabled:u||!R.trim(),children:u?"追加中...":"追加"})]}),(0,a.jsx)("div",{ref:D.containerRef,className:"space-y-2",role:"list","aria-label":"家事一覧",children:0===r.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"まだ家事が登録されていません"}):r.map(e=>{let t=e.done;return(0,a.jsx)("div",{"data-chore-name":e.title,className:"p-4 border rounded-lg ".concat(t?"bg-green-50 border-green-200":"bg-white border-gray-200"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:()=>$(e.id),className:"w-6 h-6 rounded-full border-2 flex items-center justify-center ".concat(t?"bg-green-500 border-green-500 text-white":"border-gray-300 hover:border-green-400"),"aria-label":"".concat(e.title,"を").concat(t?"未完了":"完了","にする"),children:t&&(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,a.jsx)("span",{className:t?"line-through text-gray-500":"",children:e.title})]}),(0,a.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>F(e.id),"aria-label":"".concat(e.title,"を削除"),children:"削除"})]})},e.id)})})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("form",{onSubmit:V,className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[(0,a.jsx)(g.p,{type:"text",placeholder:"新しい家事を入力",value:R,onChange:e=>I(e.target.value),disabled:u,className:"flex-1 text-sm sm:text-base","aria-label":"新しい家事名"}),(0,a.jsx)(h.$,{type:"submit",disabled:u||!R.trim(),className:"w-full sm:w-auto px-4 py-2 text-sm sm:text-base",children:u?"追加中...":"追加"})]}),(0,a.jsx)("div",{ref:D.containerRef,className:"space-y-2",role:"list","aria-label":"家事一覧",children:0===r.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"まだ家事が登録されていません"}):r.map(t=>{let r=t.done,s=t.owner_id===(null==e?void 0:e.id);return(0,a.jsxs)("div",{"data-chore-name":t.title,className:"p-3 sm:p-4 border rounded-lg ".concat(r?"bg-green-50 border-green-200":"bg-white border-gray-200"),children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,a.jsx)("button",{onClick:()=>$(t.id),className:"w-6 h-6 sm:w-7 sm:h-7 rounded-full border-2 flex items-center justify-center flex-shrink-0 ".concat(r?"bg-green-500 border-green-500 text-white":"border-gray-300 hover:border-green-400"),"aria-label":"".concat(t.title,"を").concat(r?"未完了":"完了","にする"),children:r&&(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("div",{className:"text-sm sm:text-base break-words ".concat(r?"line-through text-gray-500":""),children:t.title}),!s&&(0,a.jsxs)("div",{className:"text-xs sm:text-sm text-blue-600 mt-1",children:["(",(null==U?void 0:U.name)||"パートナー","の家事)"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[r&&!s&&(0,a.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>A(parseInt(t.id)),"aria-label":"".concat(t.title,"にありがとうメッセージを送る"),className:"text-xs sm:text-sm px-2 sm:px-3",children:"ありがとう"}),(0,a.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>F(t.id),"aria-label":"".concat(t.title,"を削除"),className:"text-xs sm:text-sm px-2 sm:px-3",children:"削除"})]})]}),T===parseInt(t.id)&&(0,a.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,a.jsx)(d.A,{choreId:(null==T?void 0:T.toString())||"",toUserId:(null==U?void 0:U.id)||"",toUserName:(null==U?void 0:U.name)||"パートナー",onSuccess:()=>A(null),onCancel:()=>A(null)})})]},t.id)})}),!1]})}function j(){let[e,t]=(0,o.useState)(!1),{notifications:r,unreadCount:s,markAsRead:l,markAllAsRead:i,removeNotification:c,clearAllNotifications:d}=(0,n.E)(),u=e=>{e.read||l(e.id),e.actionUrl&&(window.location.href=e.actionUrl)};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>t(!e),className:"relative p-2 text-gray-600 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg","aria-label":"通知を開く",children:[(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),s>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:s>99?"99+":s})]}),e&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"通知"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[s>0&&(0,a.jsx)("button",{onClick:i,className:"text-sm text-blue-600 hover:text-blue-800",children:"全て既読"}),r.length>0&&(0,a.jsx)("button",{onClick:d,className:"text-sm text-red-600 hover:text-red-800",children:"全て削除"})]})]}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===r.length?(0,a.jsx)("div",{className:"p-4 text-center text-gray-500",children:"通知はありません"}):r.map(e=>(0,a.jsx)("div",{className:"p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ".concat(((e,t)=>{let r=t?"bg-gray-50":"bg-white";switch(e){case"success":return"".concat(r," ").concat(t?"border-gray-200":"border-green-200");case"warning":return"".concat(r," ").concat(t?"border-gray-200":"border-yellow-200");case"error":return"".concat(r," ").concat(t?"border-gray-200":"border-red-200");default:return"".concat(r," ").concat(t?"border-gray-200":"border-blue-200")}})(e.type,e.read)),onClick:()=>u(e),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),u(e))},role:"button",tabIndex:0,"aria-label":"通知: ".concat(e.title),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsxs)("div",{className:"flex-shrink-0 ".concat((e=>{switch(e){case"success":return"text-green-500";case"warning":return"text-yellow-500";case"error":return"text-red-500";default:return"text-blue-500"}})(e.type)),children:["success"===e.type&&(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"warning"===e.type&&(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"error"===e.type&&(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),"info"===e.type&&(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-sm font-medium ".concat(e.read?"text-gray-600":"text-gray-900"),children:e.title}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),c(e.id)},className:"text-gray-400 hover:text-gray-600","aria-label":"通知を削除",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,a.jsx)("p",{className:"text-sm ".concat(e.read?"text-gray-500":"text-gray-700"),children:e.message}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:(e=>{let t=new Date().getTime()-e.getTime(),r=Math.floor(t/6e4),a=Math.floor(t/36e5),s=Math.floor(t/864e5);return r<1?"たった今":r<60?"".concat(r,"分前"):a<24?"".concat(a,"時間前"):"".concat(s,"日前")})(e.timestamp)})]}),!e.read&&(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})})]})},e.id))})]}),e&&(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>t(!1),onKeyDown:e=>{"Escape"===e.key&&t(!1)},role:"button",tabIndex:0,"aria-label":"通知パネルを閉じる"})]})}function N(){let{user:e,loading:t,signOut:r}=(0,s.A)(),{addNotification:i}=(0,n.E)(),c=(0,l.useRouter)();return((0,o.useEffect)(()=>{t||e||c.push("/auth/signin")},[e,t,c]),t)?(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsx)("div",{className:"text-lg",children:"読み込み中..."})}):e?(0,a.jsxs)("main",{className:"flex min-h-screen flex-col p-4 sm:p-6 lg:p-24",children:[(0,a.jsx)("header",{className:"w-full mb-6",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"text-center sm:text-left",children:[(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:"ThankYou Chores"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"家事管理アプリ"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-2 sm:gap-4",children:[(0,a.jsxs)("span",{className:"text-sm truncate",children:["こんにちは、",e.email,"さん"]}),(0,a.jsx)(h.$,{onClick:()=>{i({title:"テスト通知",message:"これはテスト用の通知です",type:"info"})},variant:"default",size:"sm",children:"テスト通知"}),(0,a.jsx)(h.$,{onClick:async()=>{try{await r(),c.push("/auth/signin")}catch(e){console.error("ログアウトに失敗しました:",e)}},variant:"destructive",size:"sm",children:"ログアウト"})]})]})}),(0,a.jsx)("div",{className:"w-full max-w-4xl mb-8",children:(0,a.jsx)(j,{})}),(0,a.jsx)("div",{className:"w-full max-w-4xl",children:(0,a.jsx)(w,{})})]}):null}},5590:(e,t,r)=>{"use strict";r.d(t,{p:()=>l});var a=r(5155),s=r(2115),n=r(4269);let l=s.forwardRef((e,t)=>{let{className:r,type:s,...l}=e;return(0,a.jsx)("input",{type:s,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...l})});l.displayName="Input"}},e=>{e.O(0,[559,707,469,948,153,441,255,358],()=>e(e.s=3807)),_N_E=e.O()}]);