(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{2478:(e,s,t)=>{Promise.resolve().then(t.bind(t,9998))},2764:(e,s,t)=>{"use strict";t.d(s,{A:()=>m});var r=t(5155),a=t(2115),n=t(3084),o=t(4153),l=t(2890),i=t(598);let d=i.Ikc({toUserId:i.YjP().uuid("有効なユーザーIDを指定してください"),choreId:i.aig().int().positive("有効な家事IDを指定してください").optional(),message:i.YjP().min(1,"メッセージを入力してください").max(500,"メッセージは500文字以内で入力してください").trim()});async function c(e,s){let t=d.parse(s),{data:r,error:a}=await l.supabase.from("thanks").insert({from_id:e,to_id:t.toUserId,message:t.message,created_at:new Date().toISOString()}).select("\n      *,\n      from_user:profiles!from_id(display_name),\n      to_user:profiles!to_id(display_name)\n    ").single();if(a)throw console.error("感謝メッセージの送信に失敗しました:",a),Error("感謝メッセージの送信に失敗しました: ".concat(a.message));return r}let u=["ありがとう！助かりました \uD83D\uDE0A","お疲れさまでした！","いつもありがとう ❤️","とても助かります！","ありがとう！愛してる \uD83D\uDC95","お疲れさま！感謝してます","ありがとう！嬉しいです","いつも本当にありがとう","お疲れさま！大好き","ありがとう！頼りになります"];function m(e){let{choreId:s,toUserId:t,toUserName:l,onSuccess:i,onCancel:d}=e,[m,x]=(0,a.useState)(""),[b,f]=(0,a.useState)(!1),[h,g]=(0,a.useState)(null),{user:p}=(0,n.A)(),{addNotification:y}=(0,o.E)(),j=async e=>{if(e.preventDefault(),!p)return void g("ログインが必要です");if(!m.trim())return void g("メッセージを入力してください");f(!0),g(null);try{let e=await c(p.id,{choreId:parseInt(s),toUserId:t,message:m.trim()});y({title:"ありがとうメッセージを送信しました",message:"".concat(l||"相手","にありがとうメッセージを送信しました"),type:"success"}),null==i||i(e),x("")}catch(e){console.error("ありがとうメッセージの送信に失敗しました:",e),g(e instanceof Error?e.message:"メッセージの送信に失敗しました。もう一度お試しください。")}finally{f(!1)}};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-md mx-auto",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:[l?"".concat(l,"さんに"):"","ありがとうメッセージを送る"]}),h&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:h}),(0,r.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,r.jsxs)("fieldset",{children:[(0,r.jsx)("legend",{className:"block text-sm font-medium text-gray-700 mb-2",children:"定型メッセージから選択"}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-2",children:u.map((e,s)=>(0,r.jsx)("button",{type:"button",onClick:()=>{x(e)},className:"text-left p-2 text-sm bg-gray-50 hover:bg-gray-100 rounded border transition-colors","aria-label":"定型メッセージを選択: ".concat(e),children:e},s))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"メッセージ"}),(0,r.jsx)("textarea",{id:"message",value:m,onChange:e=>x(e.target.value),placeholder:"ありがとうメッセージを入力してください...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:b})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{type:"submit",disabled:b||!m.trim(),className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:b?"送信中...":"送信する"}),d&&(0,r.jsx)("button",{type:"button",onClick:d,disabled:b,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"キャンセル"})]})]})]})}},9998:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var r=t(5155),a=t(2115),n=t(63),o=t(2764),l=t(3084);function i(){let e=(0,n.useSearchParams)(),{user:s,loading:t}=(0,l.A)(),i=(0,n.useRouter)(),d=e.get("choreId");return((0,a.useEffect)(()=>{t||s||i.push("/auth/signin")},[s,t,i]),t)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s?d?(0,r.jsx)("div",{className:"container mx-auto px-4 py-8","data-testid":"thank-you-container",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8 text-center",children:"ありがとうメッセージ"}),(0,r.jsx)(o.A,{choreId:d,toUserId:""})]})}):(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"エラー"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"家事IDが指定されていません。"}),(0,r.jsx)("button",{onClick:()=>i.push("/"),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"ホームに戻る"})]})}):null}function d(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:(0,r.jsx)(i,{})})}}},e=>{e.O(0,[559,469,153,441,255,358],()=>e(e.s=2478)),_N_E=e.O()}]);