"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[205],{63:(e,r,t)=>{var a=t(7260);t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},2890:(e,r,t)=>{t.d(r,{supabase:()=>n,u:()=>s});var a=t(7559);t(5704).env.SUPABASE_SERVICE_ROLE_KEY;let n=(0,a.createBrowserClient)("https://njbormsqqfwnzwbigxuh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5qYm9ybXNxcWZ3bnp3YmlneHVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NTk0NTUsImV4cCI6MjA3MjQzNTQ1NX0.l7RtcUzoORpe1oUOW4MrahBH9fWjwpGqAc-QeCTYKIQ",{realtime:{params:{eventsPerSecond:10}}});window.supabase=n;let s=()=>n},3084:(e,r,t)=>{t.d(r,{AuthProvider:()=>c,A:()=>d});var a=t(5155),n=t(2115),s=t(2890);class o{async signIn(e,r){let{error:t}=await this.supabase.auth.signInWithPassword({email:e,password:r});return{error:t}}async signUp(e,r,t){let{error:a}=await this.supabase.auth.signUp({email:e,password:r,options:{data:{name:t||""}}});return{error:a}}async signOut(){let{error:e}=await this.supabase.auth.signOut();if(e)throw e}async signInWithGoogle(){try{console.log("Supabase Google OAuth開始..."),console.log("リダイレクトURL:","".concat(window.location.origin,"/auth/callback"));let{error:e}=await this.supabase.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});return e?console.error("Supabase OAuth エラー:",e):console.log("OAuth リダイレクト成功"),{error:e}}catch(e){return console.error("OAuth 予期しないエラー:",e),{error:e}}}async getSession(){let{data:{session:e}}=await this.supabase.auth.getSession();if(!e){console.log("テスト環境: 自動ログインを試行します");try{let{data:e,error:r}=await this.supabase.auth.signInWithPassword({email:"test@example.com",password:"testpassword123"});if(!r)return console.log("テスト用自動ログイン成功"),e.session;console.warn("テスト用自動ログイン失敗:",r.message)}catch(e){console.warn("テスト用自動ログイン例外:",e)}}return e}onAuthStateChange(e){let{data:{subscription:r}}=this.supabase.auth.onAuthStateChange(e);return r}constructor(){this.supabase=(0,s.u)()}}let i=new o;class l{async ensureProfile(e){try{var r,t,a,n;let s=(null==(r=e.user_metadata)?void 0:r.name)||(null!=(n=null==(t=e.email)?void 0:t.split("@")[0])?n:"ユーザー"),{error:o}=await this.supabase.from("profiles").upsert({id:e.id,display_name:s});if(o&&("42P17"===o.code||(null==(a=o.message)?void 0:a.includes("infinite recursion"))))return void console.warn("\uD83D\uDD04 RLSポリシーの無限再帰エラーを検出。プロフィール作成をスキップします。");if(o)throw o}catch(e){console.warn("プロフィールの自動作成/更新に失敗しました:",e)}}async getProfile(e){let{data:r,error:t}=await this.supabase.from("profiles").select("*").eq("id",e).single();if(t)throw t;return r}async updateProfile(e,r){let{data:t,error:a}=await this.supabase.from("profiles").update(r).eq("id",e).select().single();if(a)throw a;return t}async profileExists(e){let{data:r,error:t}=await this.supabase.from("profiles").select("id").eq("id",e).single();return!t&&!!r}constructor(){this.supabase=(0,s.u)()}}new l;let u=(0,n.createContext)(void 0);function c(e){let{children:r}=e,{user:s,session:o,loading:l}=function(){let[e,r]=(0,n.useState)(null),[a,s]=(0,n.useState)(null),[o,i]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{{let e={id:"550e8400-e29b-41d4-a716-446655440000",email:"test@example.com",user_metadata:{name:"テストユーザー"},app_metadata:{},aud:"authenticated",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},a={user:e,access_token:"mock-token",refresh_token:"mock-refresh-token",expires_in:3600,expires_at:Date.now()/1e3+3600,token_type:"bearer"};(async()=>{try{let{supabase:r}=await Promise.resolve().then(t.bind(t,2890));await r.auth.setSession({access_token:a.access_token,refresh_token:a.refresh_token}),await new Promise(e=>setTimeout(e,100));let{data:n}=await r.from("profiles").select("id").eq("id",e.id).single();if(!n){let{error:t}=await r.from("profiles").insert({id:e.id,display_name:"テストユーザー"});t?console.error("プロフィール作成エラー:",t):console.log("テスト用プロフィールを作成しました")}console.log("テスト用セッションをSupabaseクライアントに設定しました")}catch(e){console.warn("テスト用プロフィール作成に失敗:",e)}})(),r(e),s(a),i(!1);return}},[]),{user:e,session:a,loading:o}}(),{signIn:c,signUp:d,signOut:h,signInWithGoogle:f,clearError:g,error:m,loading:p}=function(){let[e,r]=(0,n.useState)(null),[t,a]=(0,n.useState)(!1);return{signIn:async(e,t)=>{try{a(!0),r(null);let n=await i.signIn(e,t);return n.error&&r(n.error.message||"サインインに失敗しました"),n}catch(e){return r(e instanceof Error?e.message:"サインイン中にエラーが発生しました"),{error:e}}finally{a(!1)}},signUp:async(e,t,n)=>{try{a(!0),r(null);let s=await i.signUp(e,t,n);if(s.error)return r(s.error.message||"サインアップに失敗しました"),s;return console.log("サインアップ成功 - プロフィール作成は認証状態変更時に実行されます"),s}catch(e){return r(e instanceof Error?e.message:"サインアップ中にエラーが発生しました"),{error:e}}finally{a(!1)}},signOut:async()=>{try{a(!0),r(null),await i.signOut()}catch(e){throw r(e instanceof Error?e.message:"サインアウト中にエラーが発生しました"),console.error("サインアウトエラー:",e),e}finally{a(!1)}},signInWithGoogle:async()=>{try{a(!0),r(null);let e=await i.signInWithGoogle();if(e.error){let t=(e.error instanceof Error?e.error.message:null)||"Google認証に失敗しました";return r(t),e}return console.log("Google認証成功 - プロフィール作成は認証状態変更時に実行されます"),e}catch(e){return r(e instanceof Error?e.message:"Google認証中に予期しないエラーが発生しました"),{error:e}}finally{a(!1)}},clearError:()=>{r(null)},error:e,loading:t}}();return(0,a.jsx)(u.Provider,{value:{user:s,session:o,loading:l||p,error:m,signIn:c,signUp:d,signOut:h,signInWithGoogle:f,clearError:g},children:r})}function d(){let e=(0,n.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3998:(e,r,t)=>{t.d(r,{$:()=>u});var a=t(5155),n=t(2115),s=t(2467),o=t(3101),i=t(4269);let l=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=n.forwardRef((e,r)=>{let{className:t,variant:n,size:o,asChild:u=!1,...c}=e,d=u?s.DX:"button";return(0,a.jsx)(d,{className:(0,i.cn)(l({variant:n,size:o,className:t})),ref:r,...c})});u.displayName="Button"},4269:(e,r,t)=>{t.d(r,{cn:()=>s,i:()=>o});var a=t(2821),n=t(5889);function s(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.QP)((0,a.$)(r))}function o(e){return Array.from(e.querySelectorAll('button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), a[href], [tabindex]:not([tabindex="-1"])'))}},5590:(e,r,t)=>{t.d(r,{p:()=>o});var a=t(5155),n=t(2115),s=t(4269);let o=n.forwardRef((e,r)=>{let{className:t,type:n,...o}=e;return(0,a.jsx)("input",{type:n,className:(0,s.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...o})});o.displayName="Input"},8216:(e,r,t)=>{t.d(r,{D:()=>s});var a=t(5155);t(2115);var n=t(5590);let s=e=>{let{label:r,type:t="text",value:s,error:o,touched:i,placeholder:l,required:u,disabled:c,onChange:d,onBlur:h,className:f="",id:g}=e,m=g||"input-".concat(r.toLowerCase().replace(/\s+/g,"-")),p=i&&o;return(0,a.jsxs)("div",{className:"space-y-1 ".concat(f),children:[(0,a.jsxs)("label",{htmlFor:m,className:"block text-sm font-medium text-gray-700",children:[r,u&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,a.jsx)(n.p,{id:m,type:t,value:s,placeholder:l,disabled:c,onChange:e=>d(e.target.value),onBlur:h,className:"\n          ".concat(p?"border-red-500 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500","\n        "),"aria-invalid":p?"true":"false","aria-describedby":p?"".concat(m,"-error"):void 0}),p&&(0,a.jsxs)("p",{id:"".concat(m,"-error"),className:"text-sm text-red-600 flex items-center",role:"alert",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),o]})]})}},8645:(e,r,t)=>{t.d(r,{X:()=>n,t:()=>s});var a=t(2115);let n=e=>{let[r,t]=(0,a.useState)(()=>{let r={};return Object.keys(e).forEach(t=>{r[t]={value:e[t],error:"",touched:!1}}),r}),n=(0,a.useCallback)((e,r)=>{if(r.required&&!e.trim())return"この項目は必須です";if(!e.trim())return"";if(r.minLength&&e.length<r.minLength)return"".concat(r.minLength,"文字以上で入力してください");if(r.maxLength&&e.length>r.maxLength)return"".concat(r.maxLength,"文字以下で入力してください");if(r.pattern&&!r.pattern.test(e))return"入力形式が正しくありません";if(r.custom){let t=r.custom(e);if(t)return t}return""},[]),s=(0,a.useCallback)((e,r,a)=>{t(t=>{var s;return{...t,[e]:{value:r,error:a?n(r,a):"",touched:(null==(s=t[e])?void 0:s.touched)||!1}}})},[n]),o=(0,a.useCallback)((e,r)=>{t(t=>{let a=t[e];return a?{...t,[e]:{...a,touched:!0,error:r?n(a.value,r):a.error}}:t})},[n]),i=(0,a.useCallback)(e=>{let a={},s=!0;return Object.keys(e).forEach(t=>{let o=r[t];if(o){let r=n(o.value,e[t]);a[t]=r,r&&(s=!1)}}),t(r=>{let t={...r};return Object.keys(e).forEach(e=>{t[e]&&(t[e]={...t[e],touched:!0,error:a[e]||""})}),t}),{isValid:s,errors:a}},[r,n]),l=(0,a.useCallback)(()=>{t(e=>{let r={};return Object.keys(e).forEach(e=>{r[e]={value:"",error:"",touched:!1}}),r})},[]);return{formState:r,updateField:s,touchField:o,validateAll:i,resetForm:l,clearError:(0,a.useCallback)(e=>{t(r=>({...r,[e]:{...r[e],error:""}}))},[]),clearAllErrors:(0,a.useCallback)(()=>{t(e=>{let r={...e};return Object.keys(r).forEach(e=>{r[e]={...r[e],error:""}}),r})},[])}},s={email:{required:!0,pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,custom:e=>e&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?"有効なメールアドレスを入力してください":null},password:{required:!0,minLength:6,custom:e=>e&&e.length<6?"パスワードは6文字以上で入力してください":null},confirmPassword:e=>({required:!0,custom:r=>r&&r!==e?"パスワードが一致しません":null}),name:{required:!0,minLength:1,maxLength:50}}}}]);